<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Join Class</title>
    <link rel="stylesheet" href="static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Archivo+Black&amp;display=swap">
    <link rel="stylesheet" href="static/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="static/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="static/fonts/fontawesome5-overrides.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>
</head>

<body id="page-top" style="color: var(--bs-gray-900);">
    <div id="wrapper">
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <style>
                    #modal-1 {
                              pointer-events: none;
                            }
                </style>
                <div class="modal fade text-center visible" role="dialog" tabindex="-1" data-aos="fade-down" id="modal-1" >
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header" data-aos="fade-up" style="text-align: center;">
                                <h4 class="modal-title" style="text-align: center;">Webcam Check</h4>
                            </div>
                            <div class="modal-body">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-12"><div>
                                            <!--camera-->
                                            <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.25/webcam.js"></script>

                                            <style>
                                                            #my_camera{
                                                                width: 320px;
                                                                height: 240px;
                                                                border: 4px solid black;
                                                            }
                                                            </style>
                                                             <center><div id="my_camera" ></div></center><br>

                                                             <script language="JavaScript">
                                                             configure();
                                                             function configure(){
                                                                Webcam.set({
                                                                   width: 425,
                                                                   height: 320,
                                                                   dest_width: 472,
                                                                   dest_height: 313,
                                                                   image_format: 'jpeg',
                                                                   jpeg_quality: 100
                                                                });
                                                                Webcam.attach( '#my_camera' );
                                                             }
                                                             function stopCam() { Webcam.reset( '#my_camera' ); }
                                                            </script>

                                            <!--/camera-->

                                        </div></div>
                                    </div>
                                </div>
                                <p style="text-align: center;">Check if you are properly visible in the webcam</p>
                            </div>
                            <div class="modal-footer"><button class="btn btn-primary" type="button" data-bs-dismiss="modal" onclick="stopCam()">Proceed</button></div>
                        </div>
                    </div>
                </div>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
<script>
var myModal = new bootstrap.Modal(document.getElementById('modal-1'), {})
myModal.show()
 var ignoreClickOnMeElement = document.getElementById('modal-1');

  //$('#modal-1').modal({backdrop: 'static', keyboard: false})
</script>

                <div class="container-fluid">
                    <h3 class="text-dark mb-1"></h3>
                </div>
            </div>
        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </div>
    <div class="card">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <div class="card shadow border-start-primary py-2">
                        <div class="card-body">
                            <div class="row align-items-center no-gutters">
                                <div class="col me-2">
                                    <div class="text-uppercase text-primary fw-bold text-xs mb-1"><span>Class CODE: {{cid}}</span></div>
                                    <div class="text-dark fw-bold h5 mb-0"><span>{{cname}}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow border-start-primary py-2">
                        <div class="card-body">
                            <div class="row align-items-center no-gutters">
                                <div class="col me-2">
                                    <div class="text-uppercase text-primary fw-bold text-xs mb-1"><span>Session</span></div>
                                    <div class="text-dark fw-bold h5 mb-0"><span>{{SID}}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow border-start-primary py-2">
                        <div class="card-body">
                            <div class="row align-items-center no-gutters">
                                <div class="col me-2">
                                    <div class="text-uppercase text-primary fw-bold text-xs mb-1"><span>Instructor</span></div>
                                    <div class="text-dark fw-bold h5 mb-0"><span>{{Iname}}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card shadow border-start-primary py-2">
                        <div class="card-body">
                            <div class="row align-items-center no-gutters">
                                <div class="col me-2">
                                    <div class="text-uppercase text-primary fw-bold text-xs mb-1"><span>timer</span></div>
                                    <div class="text-dark fw-bold h5 mb-0"><span id="c_time"></span></div>
                                    <script>
                                    function time_convert(minutes) {
                                      var h = Math.floor(minutes / 60);
                                      var m = minutes % 60;
                                      h = h < 10 ? '0' + h : h; 
                                      m = m < 10 ? '0' + m : m; 
                                      return h + ':' + m;
                                    }
                                    
                                    function timer_main()
                                    {
                                       min2=new URLSearchParams(window.location.search).get('start_time');
                                        
                                            current_date = new Date();
                                            min = current_date.getMinutes();
                                            hr=current_date.getHours();
                                            total=hr*60+min;
                                            
                                            c_time=total-min2;
                                            if(c_time<0)
                                            {
                                                c_time=c_time+60*24;
                                            }
                                            document.getElementById('c_time').innerHTML=time_convert(c_time); 
                                        }
                                    timer_main();
                                    var start_timer = setInterval(function() {
                                           timer_main();
                                    }, 30*1000);


                                     async function runIT() {
                                      
                                      var response = await fetch("http://" + window.location.host + "/getRunning.html");
                                      var data = await response.json();
                                      var data1=data['status']
                                      if(data1==0)
                                      {console.log("redirecting");set_status();}//window.location.replace("http://" + window.location.host + "/endclass.html");}
                                      else console.log("staying...")
                                    }
                                    var close=1;
                                    function set_status()
                                    {
                                        close=0;
                                        send_status();
                                        window.location.replace("http://" + window.location.host + "/endclass.html");
                                    }

                                    function send_status() {

                                    //event.preventDefault();
                                    //var close=1

                                    let data = new FormData();
                                    //var data = close; 
                                    data.comment = "comment";

                                    data.status = close;
                                   // var url_name='http://' + window.location.host `/comment`
                                   var url_name="http://localhost:5000/comment";
                                    //console.log(url_name);

                                    console.log(JSON.stringify(data))

                                    fetch(url_name,

                                    {

                                    method: "POST",

                                    headers: new Headers({

                                      'Accept': 'application/json',
                                      'Content-Type': 'application/json'

                                    }),

                                    body: JSON.stringify(data)

                                    })

                                    .then(function (res) { return res.json(); })

                                    .then(function (data) { console.log("wrong response") })

                                    .catch(function (error) {

                                    console.log('Request failure: ', error);

                                    });

                                    return JSON.stringify(data);

                                    } 
                                    var fetchdb = setInterval(function() {
                                        runIT();
                                        send_status();
                                        //console.log(close);
                                    }, 10*1000);

                                   </script>
                                </div>
                                <div class="col-auto"><i class="fas fa-calendar fa-2x text-gray-300"></i></div>
                            </div>
                        </div> 
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1></h1>
                <hr>
            </div>
        </div>
    </div>
    <div class="container">
        <h2 style="text-align: center;"><a class="btn btn-warning btn-icon-split" role="button"><span class="text-white-50 icon" style="background: var(--bs-teal);height: 37px;"><i class="fas fa-running"></i></span><span class="text-white text" style="background: var(--bs-teal);height: 37px;width: 383.575px;">CLASS IN PROGRESS...</span></a><a class="btn btn-warning btn-icon-split" role="button"></a></h2>
    </div>
    <p style="text-align: center;color: var(--bs-red);">DO NOT CLOSE THIS TAB!</p>
    <hr style="height: 2px;">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Guidelines:</h4>
            <ul class="list-group">
                <li class="list-group-item"><span>1. Do not open any other application that requires access to webcam.</span></li>
                <li class="list-group-item"><span>2. Make sure that your face is clearly visible in camera.</span></li>
                <li class="list-group-item"><span>3. Make sure that you have a stable internet connection.&nbsp;</span></li>
                <li class="list-group-item"><span>4. Avoid refreshing this page.</span></li>
                <li class="list-group-item"><span>5. For any technical assistance you can reach out to the session instructor.</span></li>
            </ul>
            <p class="card-text"></p>
        </div>
    </div>
    <script src="static/bootstrap/js/bootstrap.min.js"></script>
    <script src="static/js/bs-init.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script src="static/js/theme.js"></script>
</body>

</html>
